pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- variables

-- player table
plr={
	-- x and y coords
 x=64,
 y=104,
	-- delta x and y
 dx=0,
 dy=0,
	-- direction player facing
 flipped=false,
	-- horizontal speed
 speed=1,
	-- initial jump force
 jump_force=-5,
 -- can player jump?
 can_jump=true,
 attacking=false,
 attack_speed=5,
 sprite=5,
 passive_sprite=5,
 first_attack_frame=6,
 last_attack_frame=7,
 attack_timer=0
}

-- environment table
env={
 -- gravity
 g=0.5,
 start_time=0,
 wait_time=0
}

-- enemy_1 table
enemy_1={
	x=120,
	y=104,
	dx=1,
	sprite=8,
	flipped=false
}

-- enemy_2 table
enemy_2={
	x=312,
	y=104,
	dx=1,
	sprite=8,
	flipped=false
}
-->8
-- update & draw

function _update()
	check_player_walk()
	check_ground_collision()
	check_wall_collision()
	check_player_jump()
	check_player_attack()
	move_player()
	move_and_collide_enemy(enemy_1)
	move_and_collide_enemy(enemy_2)
end

function _draw()
 -- update camera
 camera(max(0, plr.x-64), 0)
 -- draw the map
	map()
	-- draw the player
	spr(plr.sprite, plr.x, plr.y, 1, 1, plr.flipped)
	-- draw enemies
	spr(enemy_1.sprite, enemy_1.x,enemy_1.y,1,1,enemy_1.flipped)
	spr(enemy_2.sprite, enemy_2.x,enemy_2.y,1,1,enemy_2.flipped)
end 


-->8
-- collision & physics

function check_player_walk()
 if btn(⬅️) then
		plr.flipped=true
		plr.dx=-plr.speed
	elseif btn(➡️) then
		plr.flipped=false
		plr.dx=plr.speed
	else
		plr.dx=0
	end
end

function check_player_jump()
	if on_ground() and btn(🅾️) then
	 plr.dy=plr.jump_force
	end
end

function move_player()
	-- move player
	plr.x+=plr.dx
	if (plr.dy > 0) then
	 fix_fall()
	end
	plr.y+=plr.dy
end

function fix_fall()
	local gx1=plr.x/8
	local gx2=(plr.x+8)/8
	local gy=(plr.y+7+plr.dy)/8
	
	local a=fget(mget(gx1,gy),0)
	local b=fget(mget(gx2,gy),0)
	
	if a or b then
	 plr.y -= 1
	 fix_fall()
	end
end

-- check if on ground
function on_ground()
 local gx1=0
 local gx2=0
 local gy=0
 if not plr.flipped then
 	gx1 = plr.x/8
 	gx2 = (plr.x+5)/8
 	gy = (plr.y+8)/8
 else
	 gx1=(plr.x+2)/8
	 gx2=(plr.x+7)/8
	 gy=(plr.y+8)/8
	end
	
	local a=fget(mget(gx1,gy),0)
	local b=fget(mget(gx2,gy),0)
	
	if a or b then
	 return true
	else
	 return false
	end
end

function check_wall_collision()
	if (plr.flipped) then
		-- negative dir travel
		-- find top and bottom left
		-- check to see if that line
		-- passed a wall
		-- if so then we bound dir
		-- to that wall

		-- find left x
		local lc = (plr.x + 1) / 8
		-- find bottom y
		-- find top y
		local tc = (plr.y + 1) / 8

		-- we assume delta x is low
		-- enough that we don't phase
		if(fget(mget(lc, tc), 0)) then
			plr.dx = 0
		end
		
	else
		-- positive dir travel
		-- find right x
		local rc = (plr.x + 6) / 8
		-- find bottom y
		-- find top y
		local tc = (plr.y + 1) / 8

		-- we assume delta x is low
		-- enough that we don't phase
		if(fget(mget(rc, tc), 0)) then
			plr.dx = 0
		end
	end
end

function check_ground_collision()
	if on_ground() then
	 plr.dy=0
	else
		plr.dy+=env.g
	end
end

function check_player_attack()
	if plr.attacking then
		if plr.attack_timer < plr.attack_speed then
			plr.attack_timer+=1
		else
			plr.attack_timer=0
		 if plr.sprite < plr.last_attack_frame then
				plr.sprite+=1
			else
				plr.sprite=plr.passive_sprite
				plr.attacking=false
			end
		end
	elseif btn(❎) then
		plr.attacking=true
		plr.sprite=plr.first_attack_frame
	end
end

-- move and collide enemies
function move_and_collide_enemy(e)
 -- move & collide with wallls
 if e.dx > 0 then
 	if fget(mget((((e.x+8) / 8)),(e.y/8)),0) then
 	 e.dx=-1
 	 e.flipped=true
 	else
 		e.x+=e.dx
 	end
 elseif e.dx < 0 then
 	if fget(mget((((e.x-1) / 8)),(e.y/8)),0) then 
 		e.dx=1
 		e.flipped=false
 	else
 		e.x+=e.dx
 	end
 end
 
 -- collide with player:
 -- setup enemy hitbox
 local ecx1=e.x
 local ecx2=(e.x+7)
 local ecy1=e.y
 local ecy2=(e.y+7)
 -- setup player hitbox
 local pcx1=plr.x
 local pcx2=(plr.x+7)
 local pcy1=plr.y
 local pcy2=(plr.y+7)
 -- check for collision with player
 
end
 	
__gfx__
00000000bbbbbbbb44444444ccccccccd666666600000000000000000000000000077000cccccccccccccccccccccccccccccccccccccccccccccccc77777777
00000000bb33bb3344444444cccccccc5dddddd604444000044440000444400000777600ccccc777ccccccccccccccccccccccccccccccc7777ccccc77777777
007007003322332244444444cccccccc5dddddd604fff40004fff40004fff40007776770cccccc7777cccccccccccc7777cccccccccccc7777cccccc77777777
000770002244224444444444cccccccc5dddddd60f1f10000f1f10000f1f100076661716c99499949994999cc99499949994999cc99499949777799c77777777
000770004444444444444444cccccccc5dddddd60ffff7000ffff0070ffff0007777776799191999499949999919199949994999991919997777499977777777
007007004444444444444444cccccccc5dddddd602222700022220700222200077776677c99999977779999cc99999977779999cc99999977779999c77777777
000000004444444444444444cccccccc5dddddd6f8888400f8888400f888847706667770cccccccc7777cccccccccccccccccccccccccccccccccccc77777777
000000004444444444444444cccccccc555555dd0f00f0000f00f0000f00f00000777700cccccccccc77cccccccccccccccccccccccccccccccccccc77777777
6777777777777776cccccc7777cccccc777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6777777777777776cccc77777777cccc777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c67777777777776cccc7777777777ccc777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c67777777777776ccc777777777777cc777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cc677777777776ccc77777777777777c777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ccc6777777776cccc77777777777777c777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccc66777766cccc7777777777777777777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
cccccc6666cccccc7777777777777777666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
30303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
30303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
303030303090a0303040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
30305030803030304040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303
0303120f0f1303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303120f0f0f0f0f1303030303030303030303030303030303030303030303030303030303030303030303030303030303030303120f0f0f0f0f1303030303030303030303030303030303
030310140f0f13030303030303030303030303120f0f0f0f130303030303030303030303030303030303030303030303030303030303031014141414140f0f0f0f13030303030303030303030303030303030303030303120f0f0f0f130303030303030303030303031014141414141103030303030303030303030303030303
03030303101411030303030303030303030303101414140f0f0f0f130303030303030303030303030303030303120f0f0f0f1303030303030303030303101414141103030303030303030303030303030303030303030310141414140f0f0f0f0f0f130303030303030303030303030303030303030303030303030303030303
0303030303030303030303030303030303030303030303101414141103030303030303030303030303030303031014141414110303030303030303030303030303030303030303030303030303030303030303030303030303030303101414141414110303030303030303030303030303030303030303030303030303030303
030303030303030303120f0f0f1303030303030303030303030303030303030303030303120f0f0f130303030303030303030303030303030303030303030303030303030303030303120f0f0f0f0f13030303030303030303030303030303030303030303030303030303030404030404040404040404040404040404040404
030303030303030303101414141103030303030303030303030303030303030303120f0f0f0f0f1411030303030303030303030303030303010101030303030303030303030303030310141414141411030303030303030303030303030303030303030303030303040403030303030404040404040404040404040404040404
0303030303030303030303030303030303030303030303030303030303030303031014141414110303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030304040303030303030303030404040404040404040404040404040404
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030101010303030303030301010103030303030303030303030303030303030303030303030303030303030303030404030303030303030303030303030404040404040404040404040404040404
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030304040303040403030303030303030303030303030303030404040404040404040404040404040404
0303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030301010103030303030303030303030303030303030101010303030303030303030303030303030404030303030303030303030303030303030303030303030303030404040404040404040404040404040404
0303030303030303030303030303030303030303030303030303030303040403030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030404040404040404040404040404040404
0303030303030303030301010101030303030303030303030304040303040403030404030303030303010101030303030303030303030303010101030303030303030303030303010101030303030303040403030303030303030303030303030303030303030303030303030303030404040404040404040404040404040404
0303030303030303030102020202010303030303030404030304040303040403030404030304040303030303030303030303030101010303020202030301010103030303030303030303030303030303030303030303030303030303030303030303030303030303030303030303030404040404040404040404040404040404
0101010101010101010202020202020101010101010101010101010101010101010101010101010101010101010101010101010202020101020202010102020201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202
__sfx__
00010000093500d35011350133501535017350193501a3501c3501c3501e3500e3001d30000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
